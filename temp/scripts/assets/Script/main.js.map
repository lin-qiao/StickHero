{"version":3,"sources":["assets\\Script\\main.js"],"names":["cc","Class","extends","Component","properties","square","default","type","Prefab","stick","hero","Node","scoreLabel","Label","highestLabel","gameOver","spriteFrame","SpriteFrame","background","Sprite","score","highes","oldSquareWidth","createSquare","newSquare","instantiate","node","addChild","randomWidth","Math","floor","random","width","randomDistance","rightX","x","y","data","setPosition","runAction","moveTo","p","createStick","newStick","height","longerStick","stickHeight","longerAction","schedule","anim","getComponent","Animation","play","dropStick","scheduleOnce","stopAllActions","rotateTo","easing","easeIn","undueStick","moveBy","getBoundingBoxToWorld","removeAction","unschedule","stickAction","sequence","callFunc","endStickX","startSquareX","endSquareX","string","canvas","find","require","once","sys","localStorage","stickHero","active","onLoad","n"],"mappings":"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","file":"unknown","sourcesContent":["cc.Class({\r\n  extends: cc.Component,\r\n\r\n  properties: {\r\n    square:{  // 平台预制\r\n      default:null,\r\n      type:cc.Prefab\r\n    },\r\n    stick:{    // 棍子预制\r\n      default:null,\r\n      type:cc.Prefab\r\n    },\r\n    hero:{     // 英雄\r\n      default:null,\r\n      type:cc.Node\r\n    },\r\n    scoreLabel:{    // 分数label\r\n      default:null,\r\n      type:cc.Label\r\n    },\r\n    highestLabel:{   // 最高分\r\n      default:null,\r\n      type:cc.Label\r\n    },\r\n    gameOver:{\r\n      default:null,\r\n      type:cc.Node\r\n    },\r\n    spriteFrame:{\r\n      default:[],\r\n      type:cc.SpriteFrame\r\n    },\r\n    background:{\r\n      default:null,\r\n      type:cc.Sprite\r\n    },\r\n    score:0,        //分数\r\n    highes : 0,     //最高分\r\n    oldSquareWidth:150,\r\n  },\r\n  // 创建平台\r\n  createSquare:function(){\r\n    // 实例化平台\r\n    this.newSquare = cc.instantiate(this.square);\r\n    this.node.addChild(this.newSquare);\r\n    // 随机宽度\r\n    var randomWidth = Math.floor(Math.random()*100) + 50;\r\n    this.newSquare.width = randomWidth;\r\n\r\n    // 随机位置\r\n    var randomDistance = Math.floor(Math.random()*200) + 50;\r\n\r\n    // 距离左边的距离\r\n    this.oldSquareWidth = this.oldSquareWidth + randomDistance + randomWidth;\r\n\r\n    var rightX = this.node.width/2 + randomWidth -this.node.x;\r\n    var x =  this.oldSquareWidth - randomWidth/2 - this.node.width/2;\r\n    var y = this.square.data.y;\r\n\r\n    this.newSquare.setPosition(rightX,y);\r\n    this.newSquare.runAction(cc.moveTo(0.5,cc.p(x,y)));\r\n  },\r\n  // 创建棍子\r\n  createStick:function(){\r\n    // 实例化棍子\r\n    this.newStick = cc.instantiate(this.stick);\r\n    this.node.addChild(this.newStick);\r\n    // 位置\r\n    var x = this.hero.x + this.hero.width/2 + this.stick.data.width/2;\r\n    var y = this.hero.y - this.hero.height/2;\r\n    this.newStick.setPosition(x,y);\r\n  },\r\n  // 伸长棍子\r\n  longerStick:function(){\r\n    this.stickHeight += 8;\r\n    this.newStick.height = this.stickHeight;\r\n\r\n  },\r\n  // 触摸按下函数\r\n  longerAction:function(){\r\n    this.createStick();\r\n    this.stickHeight = 0;\r\n    // 定时器伸长棍子\r\n    this.schedule(this.longerStick,0.01)\r\n    // 播放动画\r\n    var anim = this.hero.getComponent(cc.Animation);\r\n    anim.play('heroPush');\r\n\r\n  },\r\n  // 棍子掉落\r\n  dropStick:function(){\r\n    this.scheduleOnce(function(){\r\n      // 棍子掉落\r\n      this.newStick.stopAllActions();\r\n      this.newStick.runAction(cc.rotateTo(.5,180).easing(cc.easeIn(3)));\r\n\r\n      // 英雄掉落\r\n      var y = -this.node.height/2 - this.hero.height;\r\n      var x = this.hero.x;\r\n      this.hero.stopAllActions();\r\n      this.hero.runAction(cc.moveTo(.5,cc.p(x,y)).easing(cc.easeIn(3)));\r\n    },0.5);\r\n  },\r\n  // 棍子搭在平台\r\n  undueStick:function(){\r\n    this.scheduleOnce(function(){\r\n      // 向左移动视图\r\n      this.node.stopAllActions();\r\n      this.node.runAction(cc.moveBy(0.5,cc.p(-this.newSquare.getBoundingBoxToWorld().x,0)));\r\n      // 创建平台\r\n      this.createSquare();\r\n    },0.5)\r\n  },\r\n\r\n  // 触摸放开函数\r\n  removeAction:function(){\r\n    // 取消定时器\r\n    this.unschedule(this.longerStick);\r\n    // 播放英雄动画\r\n    var anim = this.hero.getComponent(cc.Animation);\r\n    anim.play('heroTick');\r\n    // 棍子动画和回调函数\r\n    this.scheduleOnce(function(){\r\n      var stickAction = cc.sequence(\r\n        cc.rotateTo(.5,90).easing(cc.easeIn(3)),\r\n        cc.callFunc(function(){\r\n          // 棍子最远端X坐标\r\n          var endStickX = this.newStick.x + this.newStick.height;\r\n          // 平台开始X坐标\r\n          var startSquareX = this.newSquare.x - this.newSquare.width/2;\r\n          // 平台结束x坐标\r\n          var endSquareX = this.newSquare.x + this.newSquare.width/2;\r\n          if(endStickX >= startSquareX && endStickX <= endSquareX){\r\n            // 动画\r\n            var x = endSquareX - this.newStick.width - this.hero.width/2;\r\n            var y = this.hero.y;\r\n            this.hero.runAction(cc.moveTo(0.5,cc.p(x,y)));\r\n             // 棍子搭在平台\r\n            this.undueStick();\r\n            // 增加分数\r\n            this.score ++;\r\n            this.scoreLabel.string = '得分：' + this.score;\r\n            // 绑定事件\r\n            var canvas = cc.find(\"Canvas\").getComponent(require(\"canvas\"));\r\n            this.scheduleOnce(function(){\r\n              canvas.node.once('touchstart',this.longerAction,this);\r\n              canvas.node.once('touchend',this.removeAction,this);\r\n            },0.5);\r\n          }else{\r\n            // 动画\r\n            var x = endStickX - this.hero.width/2;\r\n            var y = this.hero.y;\r\n            this.hero.runAction(cc.moveTo(0.5,cc.p(x,y)));\r\n            // 棍子掉落\r\n            this.dropStick();\r\n            // 判断是否为新的最高分\r\n            if(this.highes < this.score){\r\n              cc.sys.localStorage.stickHero = this.score;\r\n            }\r\n            // gameOver\r\n            this.gameOver.active = true;\r\n          }\r\n        }, this)\r\n      );\r\n      this.newStick.runAction(stickAction);\r\n    },0.2);\r\n  },\r\n\r\n  onLoad: function () {\r\n    // 随机背景\r\n    var n = Math.floor(Math.random() * 3);\r\n    this.background.spriteFrame = this.spriteFrame[n];\r\n    // 获取最高分\r\n    if(cc.sys.localStorage.stickHero){\r\n      this.highes = cc.sys.localStorage.stickHero;\r\n    }\r\n    this.highestLabel.string = '最高分：' + this.highes;\r\n    // 创建平台\r\n    this.createSquare();\r\n  },\r\n});\r\n"]}